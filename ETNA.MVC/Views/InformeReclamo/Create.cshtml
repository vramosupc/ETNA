@model ETNA.MVC.Models.PV.InformeReclamoViewModel

@{
    ViewBag.Title = "Create";
}
<script type="text/javascript">
    
    function load() {
        var fecha = new Date();
        fecha = "0" + fecha.getDate() + "/0" + (fecha.getMonth() + 1) + "/" + fecha.getFullYear();
        // por regla de negocio, La fecha de respuesta son 5 días despues  de la fecha de reclamo.
        
        document.getElementById("FechaElaboracion").value = fecha;
    }
    window.onload = load;

    function mostrarFecha(days) {
        var fecha = new Date();
        var day = fecha.getDate()+days;
        var month = fecha.getMonth() + 1;
        var year = fecha.getFullYear();

        //var tiempo = fecha.getTime();
        //var milisegundos = parseInt(days * 24 * 60 * 60 * 1000);
        //var total = fecha.setTime(tiempo + milisegundos);
        day = (fecha.getDate().toString.length != 1) ? "0" + day : day;
        //month = (fecha.getDate().toString.length != 1) ? "0" + fecha.getDate() : fecha.getDate();
        //year = fecha.getFullYear();
        return "" + day + "/0" + month + "/" + year;
        return total;
    }
    function mensaje() {
        alert("El Reclamo se guardo correctamente");
        /*window.close();*/
    }
</script>

@using (Html.BeginForm()) {
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

<fieldset>
    <legend>InformeReclamoViewModel</legend>

    <table style="border: 1px solid white">
            <tr>
                <td style="text-align: center; font-size: 20px; font-weight: bold;" colspan="4" style="width:100%">Nuevo Informe Reclamo</td>
            </tr>        
            <tr>
                <td>@Html.LabelFor(model => model.CodigoInforme)</td>
                <td style="text-align: left">
                </td>
                <td>@Html.LabelFor(model => model.DescripcionEstado)</td>
                <td style="text-align: left">
                   Elaborado
                </td>
            </tr>

            <tr>
                <td>@Html.LabelFor(model => model.FechaElaboracion)</td>
                <td style="text-align: left">
                    @Html.TextBoxFor(model => model.FechaElaboracion,(object)new {disabled="disabled",Style="background:#cccccc;" })
                </td>
                <td>@Html.LabelFor(model => model.FechaAprobacion)</td>
                <td style="text-align: left">
                </td>
            </tr>

            <tr>
                <td>@Html.LabelFor(model => model.Descripcion)</td>
                <td colspan="3" style="text-align: left">
                    @Html.TextAreaFor(model => model.Descripcion)
                    @Html.ValidationMessageFor(model => model.Descripcion)
                </td>
            </tr>

            <tr>
                <td><Label>Código de Reclamo</Label></td>
                <td style="text-align: left">
                    <input name="CodReclamo" id="CodReclamo" placeholder="... Escribe el Codigo. de Reclamo ..."/>
                </td>
                <td colspan="2">
                    <input type="button" name="btnConsulta" id="btnConsulta" value="Consultar Reclamo"/>
                </td>
            </tr>
            <tr>
                <td colspan="4" style="text-align: center">
                    <div id="resultadoDiv"><h2>------------ Sin Resultados ----------------</h2></div>
                </td>
            </tr>

            
            @Html.HiddenFor(model => model.ReclamoId)
            <!--@Html.EditorFor(model => model.ReclamoId)-->
            @Html.ValidationMessageFor(model => model.ReclamoId)
            <tr>
                <td>@Html.LabelFor(model => model.CodigoReclamo)</td>
                <td colspan="3" style="text-align: left">
                    @Html.TextBoxFor(model => model.CodigoReclamo,(object)new {disabled="disabled",Style="background:#cccccc;" })
                </td>
            </tr>
            
            <tr>
                <td>@Html.LabelFor(model => model.FechaHoraReclamo)</td>
                <td colspan="3" style="text-align: left">
                    @Html.TextBoxFor(model => model.FechaHoraReclamo,(object)new {disabled="disabled",Style="background:#cccccc;" })
                </td>
            </tr>
            
            <tr>
                <td>@Html.LabelFor(model => model.NombreCliente)</td>
                <td colspan="3" style="text-align: left">
                    @Html.TextBoxFor(model => model.NombreCliente,(object)new {disabled="disabled",Style="background:#cccccc;" })
                </td>
            </tr>

            <tr>
                <td>@Html.LabelFor(model => model.DetalleInforme)</td>
                <td colspan="3" style="text-align: left">
                    @Html.TextAreaFor(model => model.DetalleInforme)
                    @Html.ValidationMessageFor(model => model.DetalleInforme)
                </td>
            </tr>  
            
            <tr>
                <td colspan="2" style="text-align: center">
                    <input type="submit" value="Grabar" name="btnGrabar" id="btnGrabar" />
                </td>
                <td colspan="2" style="text-align: center">
                    @Html.ActionLink("Regresar", "Index")
                </td>
            </tr>  

        </table>
     </fieldset>

}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript">
        $(document).ready(function () {

            $("#btnConsulta").click(function () {
                var codigoReclamo = $("#CodReclamo").val();

                if (codigoReclamo !== "") {
                    $('#resultadoDiv').html('<img src="/Images/ajax-loader.gif"> Buscando...');

                    var request = $.ajax({
                        url: "/Reclamo/List/" + codigoReclamo,
                        method: "GET",
                        dataType: "html"
                    });

                    request.done(function (msg) {
                        $("#resultadoDiv").html(msg);
                    });

                    request.fail(function (jqXHR, textStatus) {
                        alert("Request failed: " + textStatus);
                    });
                } else {
                    alert("Ingrese el Cod. de Reclamo a Consultar");
                }
            });

            $(".paginacion").live("click", function () {
                var codigoReclamo = $("#CodReclamo").val();
                var pagina = $(this).data("pagina");

                if (codigoReclamo !== "") {
                    $('#resultadoDiv').html('<img src="/Images/ajax-loader.gif"> loading...');

                    var request = $.ajax({
                        url: "/Reclamo/List/" + codigoReclamo + "/page/" + pagina,
                        method: "GET",
                        dataType: "html"
                    });

                    request.done(function (msg) {
                        $("#resultadoDiv").html(msg);
                    });

                    request.fail(function (jqXHR, textStatus) {
                        alert("Request failed: " + textStatus);
                    });
                } else {
                    alert("Ingrese el Cod. de Reclamo a Consultar");
                }
            });

            $(".idReclamo").live('click', function () {
                var id = $(this).data('id');
                var codigo = $(this).data('codigoreclamo');
                var fechahora = $(this).data('fechahora');
                var cliente = $(this).data('cliente');
                $("#ReclamoId").val(id);
                $("#CodigoReclamo").val(codigo);
                $("#FechaHoraReclamo").val(fechahora);
                $("#NombreCliente").val(cliente);
            });

            $("#btnGrabar").live('click', function () {

                var descripcion = $("#Descripcion").val();
                var detalle = $("#DetalleInforme").val();
                var idReclamo = $("#ReclamoId").val();
      
                if (descripcion == null || descripcion == "") {
                    alert("Debe ingresar la descripcion del informe");
                    $("#Descripcion").focus();
                    return false;
                }
                if (detalle == null || detalle == "") {
                    alert("Debe ingresar el Detalle del Informe");
                    $("#DetalleInforme").focus();
                    return false;
                }

                if (idReclamo == null || idReclamo == "") {
                    alert("Debe ingresar el Id del Reclamo");
                    $("#ReclamoId").focus();
                    return false;
                }

                if (confirm("¿Desea Registrar el Informe del reclamo?")) {
                    alert("Se registró correctamente el reclamo");
                } else {
                    return false;
                }

            });
        });
    </script>

}

